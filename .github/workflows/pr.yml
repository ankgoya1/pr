name: Create Pull Request

on:
  workflow_dispatch:
  push:
    branches:
      - dev

jobs:
  create_pr:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Create Pull Request
        run: |
          # curl -L -X POST   -H "Accept: application/vnd.github+json"   -H "Authorization: Bearer ${{ secrets.GIT_PASS }}"   https://api.github.com/repos/ankgoya1/pr/pulls   -d '{"title":"Amazing new feature","body":"Please pull these awesome changes in!","head":"featureankit","base":"main"}'
          token="${{ secrets.GIT_PASS }}"
          base="featureankit"
          head="main"
          title="Merge from dev to qa"
          body="This pull request is automatically generated to merge changes from dev to qa."

          # Create Pull Request
          pr_response=$(curl -X POST \
            -H "Authorization: token $token" \
            -d '{"title":"'"$title"'","body":"'"$body"'","head":"'"$head"'","base":"'"$base"'"}' \
            https://api.github.com/repos/${{ github.repository }}/pulls)

          pr_number=$(echo $pr_response | jq -r '.number')

          # Merge Pull Request
          curl -X PUT \
            -H "Authorization: token $token" \
            https://api.github.com/repos/${{ github.repository }}/pulls/$pr_number/merge
